import { createTwitchClient } from "./twitch_client"
import db from "../db/firebase"

const client = createTwitchClient()

const migrationUsers = [
  "79695517",
  "520567011",
  "612355704",
  "1120098429",
  "819349154",
  "43240793",
  "667648132",
  "556413191",
  "266235307",
  "202851594",
  "1097280457",
  "426943067",
  "498472062",
  "132487003",
  "767887350",
  "780588352",
  "550399553",
  "983588763",
  "507033044",
  "821885715",
  "509209726",
  "43852767",
  "41946984",
  "123844458",
  "559416267",
  "80721673",
  "80780523",
  "527718148",
  "90226542",
  "914253763",
  "845891002",
  "720843294",
  "91463408",
  "247001664",
  "579659720",
  "174090032",
  "411019453",
  "519606380",
  "896358074",
  "513547530",
  "52565547",
  "57188953",
  "73451533",
  "64213937",
  "80862498",
  "95480758",
  "128696309",
  "133639214",
  "138428250",
  "142666108",
  "152320428",
  "159415518",
  "163779302",
  "249950467",
  "420135682",
  "434113806",
  "504447284",
  "576235399",
  "590403437",
  "604317682",
  "623209510",
  "418529693",
  "645611022",
  "1135711425",
  "627388722",
  "118593957",
  "277832736",
  "508082581",
  "220510834",
  "470982102",
  "192517346",
  "100318808",
  "110217653",
  "438557394",
  "530897551",
  "81831781",
  "859809597",
  "635827574",
  "7229613",
  "511448413",
  "156998055",
  "163610044",
  "1045337801",
  "101927772",
  "213729274",
  "188853182",
  "198787391",
  "569776247",
  "407049359",
]

Promise.all(migrationUsers.map(async user => {
  const doc = await db.collection("twitch_notifiers").doc(user).get()
  const data = doc.data() as { subscriptionId: string }
  const subscription = data.subscriptionId
  await client.deleteSubscription(subscription)
  const sub = await client.subscribeBroadcasterStreamOnline(user) as {
    data?: { id: string }[]
  }
  const newSubscriptionId = sub.data?.[0]?.id
  await db.collection("twitch_notifiers").doc(user).update({ subscriptionId: newSubscriptionId })
}))

